<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Dashboard admin - Loto Tracker</title>

  <link rel="icon" href="/assets/img/favicon-admin.ico" />
  <link rel="stylesheet" href="/assets/css/admin-dashboard.css" />
</head>

<body>
  <!-- Topbar inject√©e -->
  <div id="appHeader"></div>

  <div class="layout">
    <aside id="sidebar" class="sidebar" aria-label="Menu d'administration">
      <div class="brand-block">
        <div class="brand-kicker">Loto Tracker API</div>
      </div>

      <nav class="nav" aria-label="Navigation">
        <button class="nav-item active" data-section="swagger" type="button">
          <span class="nav-ico" aria-hidden="true">
            <svg viewBox="0 0 24 24"><path d="M4 19a2 2 0 0 0 2 2h14"/><path d="M6 17V5a2 2 0 0 1 2-2h12v18H8a2 2 0 0 1-2-2z"/></svg>
          </span>
          <span>Swagger / API</span>
        </button>

        <button class="nav-item" data-section="logs" type="button">
          <span class="nav-ico" aria-hidden="true">
            <svg viewBox="0 0 24 24"><path d="M4 17l6-6-6-6"/><path d="M12 19h8"/></svg>
          </span>
          <span>Logs serveur</span>
        </button>

        <button class="nav-item" data-section="info" type="button">
          <span class="nav-ico" aria-hidden="true">
            <svg viewBox="0 0 24 24"><path d="M12 17v-6"/><path d="M12 8h.01"/><path d="M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0z"/></svg>
          </span>
          <span>Infos / Debug</span>
        </button>

        <button class="nav-item" data-section="owasp" type="button">
          <span class="nav-ico" aria-hidden="true">
            <svg viewBox="0 0 24 24">
              <path d="M12 1l9 4v6c0 5-3.8 9.7-9 11-5.2-1.3-9-6-9-11V5l9-4z"/>
              <path d="M9 12l2 2 4-4"/>
            </svg>
          </span>
          <span>S√©curit√© OWASP</span>
        </button>


        <button class="nav-item" data-section="db" type="button">
          <span class="nav-ico" aria-hidden="true">
            <svg viewBox="0 0 24 24"><ellipse cx="12" cy="5" rx="8" ry="3"/><path d="M4 5v6c0 1.7 3.6 3 8 3s8-1.3 8-3V5"/><path d="M4 11v6c0 1.7 3.6 3 8 3s8-1.3 8-3v-6"/></svg>
          </span>
          <span>Base de donn√©es (CRUD)</span>
        </button>

        <button class="nav-item" data-section="stats" type="button">
          <span class="nav-ico" aria-hidden="true">
            <svg viewBox="0 0 24 24"><path d="M4 19V5"/><path d="M4 19h16"/><path d="M8 17v-6"/><path d="M12 17v-10"/><path d="M16 17v-3"/></svg>
          </span>
          <span>Stats joueurs</span>
        </button>
      </nav>

      <!-- Toujours visible en bas -->
      <div class="sidebar-footer">
        Connect√© en tant qu'<span class="strong">administrateur</span>.<br />
        Profil Spring : <span class="strong green">dev</span>
      </div>
    </aside>

    <div class="content">
      <header class="admin-pagebar">
        <h1 id="pageTitle" class="title">Tableau de bord administrateur</h1>
        <p id="pageSubtitle" class="subtitle">Vue g√©n√©rale : Swagger, logs serveur, debug.</p>
      </header>

      <main class="main">
        <!-- SWAGGER -->
        <section id="section-swagger" class="panel show">
          <div class="panel-head">
            <div class="row wrap">
              <button id="btnOpenSwagger" class="btn btn-primary" type="button">
                Ouvrir Swagger (nouvel onglet)
              </button>
              <span class="muted small">(L‚Äôiframe peut √™tre bloqu√©e en cross-origin : SAMEORIGIN)</span>
            </div>
          </div>

          <div class="panel-body center">
            <a id="swaggerLink" href="http://localhost:8082/swagger-ui/index.html" target="_blank" rel="noopener noreferrer">
              <img src="/assets/img/swagger.png" alt="Aper√ßu Swagger API" class="preview-img" />
            </a>
            <p class="muted small" style="margin-top:10px;text-align:center;">
              Pour des raisons de s√©curit√© (X-Frame-Options), Swagger s‚Äôouvre dans un nouvel onglet.
            </p>
          </div>
        </section>

        <!-- LOGS -->
        <section id="section-logs" class="panel">
          <div class="panel-head">
            <div class="row wrap">
              <span class="muted">Logs du backend (lecture seule).</span>
              <button id="btnRefreshLogs" class="btn btn-primary" type="button">Rafra√Æchir</button>

              <label class="muted small">
                Lignes :
                <select id="logLineCount">
                  <option value="200">200</option>
                  <option value="400" selected>400</option>
                  <option value="800">800</option>
                  <option value="1000">1000</option>
                  <option value="2000">2000</option>
                </select>
              </label>

              <label class="muted small check">
                <input type="checkbox" id="autoScrollLogs" checked />
                Auto-scroll
              </label>

              <label class="muted small check">
                <input type="checkbox" id="autoRefreshLogs" checked />
                Auto-refresh (3s)
              </label>

              <span id="logsLastRefresh" class="muted small">Dernier refresh : -</span>
            </div>
          </div>

          <pre id="logsContainer" class="logs">Chargement des logs...</pre>
        </section>

        <!-- INFO -->
        <!-- <section id="section-info" class="panel">
          <div class="card">
            <h2 class="h2">Debug</h2>
            <p class="muted">V√©rifie que le backend r√©pond et que le cookie JWT est bien envoy√©.</p>

            <div class="row wrap">
              <button id="btnPing" class="btn btn-primary" type="button">Tester /admin/ping</button>
              <code id="pingResult" class="code">-</code>
            </div>

            <div class="muted small">
              API utilis√©e par ce dashboard : <code id="apiBase" class="code">-</code>
            </div>
          </div>
        </section> -->

        <!-- INFO -->
        <section id="section-info" class="panel">
          <div class="card">
            <h2 class="h2">Supervision et diagnostic</h2>
            <p class="muted">V√©rifie que le backend r√©pond et que le cookie JWT est bien envoy√©.</p>

            <div class="row wrap">
              <button id="btnAll" class="btn btn-primary" type="button">Tout tester</button>
              <button id="btnPing" class="btn btn-primary" type="button">/api/admin/ping</button>
              <button id="btnHealth" class="btn btn-ghost" type="button">/api/admin/health</button>
              <button id="btnRuntime" class="btn btn-ghost" type="button">/api/admin/runtime</button>
              <button id="btnUptime" class="btn btn-ghost" type="button">/api/admin/uptime</button>
              <button id="btnCookies" class="btn btn-ghost" type="button">/api/admin/cookies</button>
              <button id="btnReqCtx" class="btn btn-ghost" type="button">/api/admin/request-context</button>
            </div>

            <div style="margin-top:10px;">
              <div class="muted small">
                API utilis√©e par ce dashboard : <code id="apiBase" class="code">-</code>
              </div>
              <div class="muted small" style="margin-top:8px;">
                R√©sultat : <code id="debugStatus" class="code">-</code>
                <div class="debug-recap">
                  <table class="debug-table">
                    <thead>
                      <tr>
                        <th>Endpoint</th>
                        <th>Code</th>
                        <th>Dur√©e</th>
                        <th>R√©sum√©</th>
                      </tr>
                    </thead>
                    <tbody id="debugTableBody">
                      <!-- rempli en JS -->
                    </tbody>
                  </table>
                </div>

              </div>
              <!-- <pre id="debugOutput" class="debug-pre">Clique un bouton pour tester‚Ä¶</pre> -->
            </div>
          </div>
        </section>

        <!-- OWASP SCORE -->
        <section id="section-owasp" class="panel">
          <div class="card">
            <h2 class="h2">OWASP Score (SAFE)</h2>
            <!-- <p class="muted">Lance owasp_score_detail.sh (mode SAFE, non destructif) et affiche le score + conseils front.</p> -->

            <!-- <div class="row wrap">
              <button id="btnOwaspRun" class="btn btn-primary" type="button">Lancer OWASP (safe)</button>
              <button id="btnOwaspDetail" class="btn btn-ghost" type="button">Lancer OWASP (detail)</button>
              <button id="btnOwaspExportJson" class="btn btn-ghost" type="button">üì• Export JSON</button>
              <button id="btnOwaspExportPdf" class="btn btn-ghost" type="button">üìÑ Export PDF</button>
            </div> -->

            <div class="row wrap">
              <!-- ‚úÖ Lecture seule -->
              <button id="btnOwaspView" class="btn btn-primary" type="button">Voir le dernier rapport</button>
              <button id="btnOwaspViewDetail" class="btn btn-ghost" type="button">Voir d√©tails</button>

              <!-- ‚úÖ Action contr√¥l√©e (POST) : ‚ÄúRafra√Æchir‚Äù -->
              <button id="btnOwaspRefresh" class="btn btn-ghost" type="button">Rafra√Æchir le rapport</button>

              <button id="btnOwaspExportJson" class="btn btn-ghost" type="button">üì• Export JSON</button>
              <button id="btnOwaspExportPdf" class="btn btn-ghost" type="button">üìÑ Export PDF</button>
            </div>

            <div class="muted small" style="margin-top:6px">
              <span id="owaspExportStatus">-</span>
            </div>

            <div id="owaspExportTimer" class="export-timer hidden">
              <div class="export-timer-bar"></div>
            </div>


            <div style="margin-top:10px;">
              <div class="muted small">R√©sultat : <code id="owaspStatus" class="code">-</code></div>
            </div>

            <div class="debug-recap" style="margin-top:12px;">
              <table class="debug-table">
                <thead>
                  <tr>
                    <th>Cat√©gorie</th>
                    <th>Score</th>
                    <th>Commentaire</th>
                  </tr>
                </thead>
                <tbody id="owaspTableBody"></tbody>
              </table>
            </div>

            <div style="margin-top:12px;">
              <h3 class="h3">Conseils d‚Äôam√©lioration (Front)</h3>
              <ul id="owaspTips" style="margin:8px 0 0; padding-left: 20px;"></ul>
            </div>

            <!-- <pre id="owaspRaw" class="debug-pre" style="margin-top:12px;">-</pre> -->
          </div>
        </section>



        <!-- DB CRUD -->
        <section id="section-db" class="panel">
          <div class="card">
            <div class="row wrap">
              <span class="muted">Vue base de donn√©es (CRUD simplifi√©).</span>

              <label class="muted small">
                Table :
                <select id="dbResourceSelect" class="select">
                  <option value="users">users</option>
                  <option value="tickets">tickets</option>
                  <option value="ticket_gains">ticket_gains</option>
                  <option value="refresh_tokens">refresh_tokens (lecture seule)</option>
                </select>
              </label>

              <button id="btnLoadData" class="btn btn-primary" type="button">Charger</button>
              <button id="btnNewRow" class="btn btn-ghost" type="button">‚ûï Nouvelle ligne</button>

              <span id="dbStatus" class="muted small">-</span>
            </div>

            <div class="row wrap" style="margin-top:10px;">
              <label class="muted small">
                Recherche :
                <input id="dbSearch" class="input" type="text" placeholder="Filtrer..." />
              </label>

              <label class="muted small">
                Lignes / page :
                <select id="dbPageSize" class="select">
                  <option value="20" selected>20</option>
                  <option value="50">50</option>
                  <option value="100">100</option>
                </select>
              </label>

              <span id="dbPagingInfo" class="muted small">Page 1 / 1</span>

              <div class="row" style="gap:6px;">
                <button id="dbPrevPage" class="btn btn-ghost" type="button">‚óÄ</button>
                <button id="dbNextPage" class="btn btn-ghost" type="button">‚ñ∂</button>
              </div>
            </div>

            <div id="dbTableWrapper" class="table-wrap" style="margin-top:12px;">
              <table id="dbTable" class="table">
                <thead id="dbTableHead"></thead>
                <tbody id="dbTableBody"></tbody>
              </table>
            </div>
          </div>

          <!-- MODAL CRUD -->
          <div id="dbModalOverlay" class="modal-overlay" aria-hidden="true">
            <div class="modal" role="dialog" aria-modal="true" aria-labelledby="dbModalTitle">
              <h2 id="dbModalTitle" class="h2">Nouvelle ligne</h2>
              <form id="dbModalForm" class="modal-form"></form>
              <div class="row" style="justify-content:flex-end;margin-top:12px;">
                <button id="dbModalCancel" type="button" class="btn btn-ghost">Annuler</button>
                <button id="dbModalSave" type="button" class="btn btn-primary">Enregistrer</button>
              </div>
            </div>
          </div>
        </section>

        <!-- TICKETS MODAL -->
        <div id="ticketsOverlay" class="modal-overlay" aria-hidden="true">
          <div class="modal modal-tickets" role="dialog" aria-modal="true" aria-labelledby="ticketsTitle">
            <div class="row" style="justify-content:space-between; align-items:center;">
              <h2 id="ticketsTitle" class="h2" style="margin:0;">Tickets</h2>
              <!-- <button id="ticketsClose" type="button" class="btn btn-ghost">Fermer</button> -->
              <div class="row" style="gap:8px;">
                <button id="ticketsCopy" type="button" class="btn btn-ghost">Copier</button>
                <button id="ticketsClose" type="button" class="btn btn-ghost">Fermer</button>
              </div>
            </div>

            <div id="ticketsMeta" class="muted small" style="margin:8px 0 10px;"></div>

            <div class="tickets-wrap">
              <table class="tickets-table">
                <thead>
                  <tr>
                    <th>Grille</th>
                    <th>Chance</th>
                    <th>Date</th>
                    <th>Jour</th>
                    <th>Cr√©√©</th>
                    <th>Modifi√©</th>
                  </tr>
                </thead>
                <tbody id="ticketsBody"></tbody>
              </table>
            </div>
          </div>
        </div>


        <!-- STATS -->
        <section id="section-stats" class="panel">
          <div class="card">
            <div class="row wrap">
              <span class="muted">Analyse des joueurs et de leurs tickets.</span>
              <button id="btnLoadStats" class="btn btn-primary" type="button">Recharger</button>

              <label class="muted small">
                Filtrer par email :
                <input id="statsSearch" class="input" type="text" placeholder="user@exemple.com" />
              </label>

              <span id="statsStatus" class="muted small">-</span>
            </div>

            <div id="statsGrid" class="stats-grid" style="margin-top:12px;"></div>
          </div>
        </section>
      </main>
    </div>
  </div>

  <!-- Overlay sidebar mobile -->
  <div id="sidebarOverlay" class="sidebar-overlay" hidden></div>

  <!-- Confirm modal -->
  <div id="confirmOverlay" class="modal-overlay" aria-hidden="true">
    <div class="modal modal-confirm" role="dialog" aria-modal="true" aria-labelledby="confirmTitle">
      <h2 id="confirmTitle" class="h2">Confirmation</h2>
      <p id="confirmText" class="muted" style="margin:6px 0 14px;"></p>
      <div class="row" style="justify-content:flex-end;gap:10px;">
        <button id="confirmCancel" type="button" class="btn btn-ghost">Annuler</button>
        <button id="confirmOk" type="button" class="btn btn-primary danger">Confirmer</button>
      </div>
    </div>
  </div>

  <!-- Toast -->
  <div id="toast" class="toast" role="status" aria-live="polite"></div>

  <!-- <button id="logoutBtn" type="button">
    D√©connexion
  </button> -->


  <script src="/assets/js/layout-dashboard.js"></script>
  <script src="/assets/js/admin-dashboard.js"></script>
</body>
</html>
