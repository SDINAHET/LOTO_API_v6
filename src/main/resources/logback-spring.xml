<?xml version="1.0" encoding="UTF-8"?>
<configuration scan="true">

  <!-- ===================================================== -->
  <!-- ðŸ“ Chemin des logs (configurable via application.properties) -->
  <!-- app.logs.path=./logs                                 -->
  <!-- ===================================================== -->
  <springProperty
      scope="context"
      name="LOG_PATH"
      source="app.logs.path"
      defaultValue="./logs"/>

  <!-- ===================================================== -->
  <!-- ðŸ“ Format des logs                                    -->
  <!-- ===================================================== -->
  <property name="LOG_PATTERN"
            value="%d{yyyy-MM-dd HH:mm:ss} %-5level [%thread] %logger - %msg%n"/>

  <!-- ===================================================== -->
  <!-- ðŸ“º CONSOLE (DEV)                                     -->
  <!-- ===================================================== -->
  <appender name="CONSOLE" class="ch.qos.logback.core.ConsoleAppender">
    <encoder>
      <pattern>${LOG_PATTERN}</pattern>
    </encoder>
  </appender>

  <!-- ===================================================== -->
  <!-- ðŸ“¦ APPLICATION (tous les logs gÃ©nÃ©raux)               -->
  <!-- ===================================================== -->
  <appender name="APP_FILE"
            class="ch.qos.logback.core.rolling.RollingFileAppender">
    <file>${LOG_PATH}/application.log</file>
    <rollingPolicy class="ch.qos.logback.core.rolling.TimeBasedRollingPolicy">
      <fileNamePattern>${LOG_PATH}/application.%d{yyyy-MM-dd}.log.gz</fileNamePattern>
      <maxHistory>90</maxHistory>
      <totalSizeCap>1000MB</totalSizeCap>
    </rollingPolicy>
    <encoder>
      <pattern>${LOG_PATTERN}</pattern>
    </encoder>
  </appender>

  <!-- ===================================================== -->
  <!-- ðŸšª ACCESS LOGS                                       -->
  <!-- ===================================================== -->
  <appender name="ACCESS_FILE"
            class="ch.qos.logback.core.rolling.RollingFileAppender">
    <file>${LOG_PATH}/access.log</file>
    <rollingPolicy class="ch.qos.logback.core.rolling.TimeBasedRollingPolicy">
      <fileNamePattern>${LOG_PATH}/access.%d{yyyy-MM-dd}.log.gz</fileNamePattern>
      <maxHistory>90</maxHistory>
      <totalSizeCap>1000MB</totalSizeCap>
    </rollingPolicy>
    <encoder>
      <pattern>${LOG_PATTERN}</pattern>
    </encoder>
  </appender>

  <!-- ===================================================== -->
  <!-- ðŸ” SECURITY LOGS                                     -->
  <!-- ===================================================== -->
  <appender name="SECURITY_FILE"
            class="ch.qos.logback.core.rolling.RollingFileAppender">
    <file>${LOG_PATH}/security.log</file>
    <rollingPolicy class="ch.qos.logback.core.rolling.TimeBasedRollingPolicy">
      <fileNamePattern>${LOG_PATH}/security.%d{yyyy-MM-dd}.log.gz</fileNamePattern>
      <maxHistory>90</maxHistory>
      <totalSizeCap>1000MB</totalSizeCap>
    </rollingPolicy>
    <encoder>
      <pattern>${LOG_PATTERN}</pattern>
    </encoder>
  </appender>

  <!-- ===================================================== -->
  <!-- ðŸ“Š ANALYTICS / NAVIGATION LOGS                        -->
  <!-- ===================================================== -->
  <appender name="ANALYTICS_FILE"
            class="ch.qos.logback.core.rolling.RollingFileAppender">
    <file>${LOG_PATH}/analytics.log</file>
    <rollingPolicy class="ch.qos.logback.core.rolling.TimeBasedRollingPolicy">
      <fileNamePattern>${LOG_PATH}/analytics.%d{yyyy-MM-dd}.log.gz</fileNamePattern>
      <maxHistory>90</maxHistory>
      <totalSizeCap>1000MB</totalSizeCap>
    </rollingPolicy>
    <encoder>
      <pattern>${LOG_PATTERN}</pattern>
    </encoder>
  </appender>

  <!-- ===================================================== -->
  <!-- âŒ ERROR LOGS (ERROR uniquement)                      -->
  <!-- ===================================================== -->
  <appender name="ERROR_FILE"
            class="ch.qos.logback.core.rolling.RollingFileAppender">
    <file>${LOG_PATH}/error.log</file>
    <rollingPolicy class="ch.qos.logback.core.rolling.TimeBasedRollingPolicy">
      <fileNamePattern>${LOG_PATH}/error.%d{yyyy-MM-dd}.log.gz</fileNamePattern>
      <maxHistory>90</maxHistory>
      <totalSizeCap>1000MB</totalSizeCap>
    </rollingPolicy>

    <filter class="ch.qos.logback.classic.filter.LevelFilter">
      <level>ERROR</level>
      <onMatch>ACCEPT</onMatch>
      <onMismatch>DENY</onMismatch>
    </filter>

    <encoder>
      <pattern>${LOG_PATTERN}</pattern>
    </encoder>
  </appender>

  <!-- ===================================================== -->
  <!-- ðŸŽ¯ LOGGERS NOMMÃ‰S                                    -->
  <!-- ===================================================== -->

  <logger name="ACCESS_LOG" level="INFO" additivity="false">
    <appender-ref ref="ACCESS_FILE"/>
  </logger>

  <!-- <logger name="SECURITY_LOG" level="WARN" additivity="false">
    <appender-ref ref="SECURITY_FILE"/>
  </logger> -->

  <logger name="ANALYTICS_LOG" level="INFO" additivity="false">
    <appender-ref ref="ANALYTICS_FILE"/>
  </logger>

  <!-- ===================================================== -->
  <!-- ðŸŒ ROOT LOGGER                                       -->
  <!-- ===================================================== -->
  <root level="INFO">
    <appender-ref ref="APP_FILE"/>
    <appender-ref ref="ERROR_FILE"/>
    <appender-ref ref="CONSOLE"/>
  </root>

  <!-- ===================================================== -->
  <!-- ðŸ” SECURITY LOGGERS                                  -->
  <!-- ===================================================== -->

  <!-- Logger manuel (si tu fais log.warn("SECURITY_LOG", ...) -->
  <logger name="SECURITY_LOG" level="INFO" additivity="false">
  <appender-ref ref="SECURITY_FILE"/>
  </logger>

  <!-- Spring Security (le plus important) -->
  <logger name="org.springframework.security" level="INFO" additivity="false">
  <appender-ref ref="SECURITY_FILE"/>
  </logger>

  <logger name="org.springframework.security.web" level="INFO" additivity="false">
  <appender-ref ref="SECURITY_FILE"/>
  </logger>


<!-- ===================================================== -->
<!-- âœ… SESSION LOGS (login/logout/duration)                -->
<!-- ===================================================== -->

<property name="SESSION_PATTERN"
          value="ts=%d{yyyy-MM-dd'T'HH:mm:ssXXX} level=%-5level event=%msg userId=%X{userId} sessionId=%X{sessionId} ip=%X{ipMasked}%n"/>

<appender name="SESSION_FILE"
          class="ch.qos.logback.core.rolling.RollingFileAppender">
  <file>${LOG_PATH}/sessions.log</file>

  <rollingPolicy class="ch.qos.logback.core.rolling.TimeBasedRollingPolicy">
    <fileNamePattern>${LOG_PATH}/sessions.%d{yyyy-MM-dd}.log.gz</fileNamePattern>
    <maxHistory>30</maxHistory>
    <totalSizeCap>300MB</totalSizeCap>
  </rollingPolicy>

  <encoder>
    <pattern>${SESSION_PATTERN}</pattern>
  </encoder>
</appender>

<logger name="SESSION_LOG" level="INFO" additivity="false">
  <appender-ref ref="SESSION_FILE"/>
</logger>




</configuration>
